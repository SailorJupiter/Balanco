<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Balanço Mobile — Produção & Bar</title>

<!-- jsPDF + autoTable (CDN) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
  :root{
    --petroleo:#0f5f5c;
    --petroleo-strong:#0d3f40;
    --grafite:#222222;
    --bg:#f4f6f6;
    --card:#ffffff;
    --muted:#6b6b74;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color: rgba(0,0,0,0.06);}
  html,body{height:100%;margin:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial;color:#222}
  .wrap{max-width:520px;margin:0 auto;padding:16px}
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .title{font-size:18px;color:var(--petroleo);font-weight:700}
  .btn-pdf{background:transparent;border:1px solid var(--petroleo);color:var(--petroleo);padding:8px 10px;border-radius:10px;cursor:pointer;min-height:40px}

  .card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 6px 18px rgba(0,0,0,0.06)}
  .card h3{margin:0 0 10px 0;color:var(--petroleo-strong)}
  .row-buttons{display:flex;gap:10px;flex-wrap:wrap}
  .main-btn{flex:1;background:var(--petroleo-strong);color:white;padding:12px;border-radius:12px;border:none;font-size:15px;cursor:pointer;min-height:44px}
  .secondary-btn{background:var(--grafite);color:white;padding:10px;border-radius:10px;border:none;cursor:pointer;min-height:44px}

  .prod-search{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e6e9;margin-bottom:10px;font-size:15px}
  .prod-grid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:8px;max-height:62vh;overflow:auto;padding-bottom:8px;-webkit-overflow-scrolling:touch}
  .prod-btn{background:var(--grafite);color:white;padding:12px;border-radius:12px;border:none;text-align:left;cursor:pointer;display:flex;align-items:center;justify-content:space-between;font-size:14px;min-height:54px}
  .prod-name{flex:1;padding-right:8px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

  .muted{color:var(--muted);font-size:13px}
  .actions{display:flex;gap:10px;margin-top:10px}
  .wide{width:100%}

  /* modal bottom sheet */
  .modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.35);align-items:flex-end;justify-content:center;padding:12px;z-index:60}
  .sheet{width:100%;max-width:520px;background:var(--card);border-radius:14px 14px 6px 6px;padding:14px;box-shadow:0 -6px 24px rgba(0,0,0,0.12)}
  .sheet h4{margin:0 0 8px 0}
  .form-row{display:flex;align-items:center;gap:8px;margin:8px 0;flex-wrap:wrap}
  .form-row label{min-width:110px;color:#333}
  .form-row input, .form-row select{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e6e9;font-size:15px}
  .modal-actions{display:flex;gap:8px;margin-top:12px}
  .btn-save{background:var(--petroleo);color:#fff;padding:10px;border-radius:10px;border:none;flex:1;min-height:44px}
  .btn-cancel{background:#ddd;color:#222;padding:10px;border-radius:10px;border:none;flex:1;min-height:44px}

  .entry{background:#fff;border-radius:10px;padding:10px;margin:8px 0;box-shadow:0 4px 12px rgba(0,0,0,0.06);display:flex;justify-content:space-between;align-items:center}
  .entry small{color:var(--muted);display:block;font-size:12px}

  .footer-actions{position:fixed;left:0;right:0;bottom:0;padding:10px;background:linear-gradient(180deg, rgba(244,246,246,0), #fff 8%), #fff;display:flex;gap:10px;justify-content:center;box-shadow:0 -6px 18px rgba(0,0,0,0.06)}
  .footer-actions .secondary-btn{flex:1;max-width:360px}

  @media(min-width:700px){
    .wrap{padding:24px}
    .prod-grid{gap:12px}
    .footer-actions{display:none}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="title">Balanço Mobile</div>
      <button class="btn-pdf" id="openPdfModal">Gerar PDF</button>
    </div>

    <!-- MENU -->
    <div class="card" id="menu">
      <h3>HOME</h3>
      <div class="row-buttons">
        <button class="main-btn" id="btnProducao">Produção</button>
        <button class="main-btn" id="btnBar">Bar</button>
        <button class="secondary-btn" id="btnCadastrar">Cadastrar produto</button>
      </div>
      <div class="muted" style="margin-top:10px">Escolha “Produção” ou “Bar” para abrir a lista de produtos.</div>
    </div>

    <!-- PRODUCTS VIEW -->
    <div class="card" id="prodCard" style="display:none">
      <h3 id="prodTitle">Produtos</h3>
      <input id="searchInput" class="prod-search" placeholder="Buscar produto..." />
      <div class="prod-grid" id="prodGrid" aria-live="polite" role="list"></div>
      <div class="actions" style="margin-top:12px">
        <button class="secondary-btn wide" id="backHome">Voltar</button>
        <button class="secondary-btn wide" id="viewAddedBtn">Ver itens adicionados</button>
      </div>
    </div>

    <!-- ADDED LIST -->
    <div class="card" id="addedCard" style="display:none">
      <h3 id="addedTitle">Itens adicionados</h3>
      <div id="addedList"></div>
      <div style="margin-top:10px" class="actions">
        <button class="secondary-btn wide" id="backFromAdded">Voltar</button>
        <button class="secondary-btn wide" id="clearBalance">Limpar lista</button>
      </div>
    </div>

    <!-- CADASTRO -->
    <div class="card" id="cadCard" style="display:none">
      <h3>Cadastrar produto</h3>
      <div class="form-row"><label>Nome</label><input id="newName" placeholder="Nome do produto"></div>
      <div class="form-row"><label>Unidade</label>
        <select id="newUnit"><option value="UN">UN</option><option value="KG">KG</option><option value="L">L</option></select>
      </div>
      <div class="form-row"><label>Categoria</label>
        <select id="newScope"><option value="producao">Produção</option><option value="bar">Bar</option></select>
      </div>
      <div class="actions"><button class="btn-save" id="saveNew">Salvar produto</button><button class="btn-cancel" id="cancelNew">Cancelar</button></div>
    </div>
  </div>

  <!-- MODAL QUANTIDADE / EDIT -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true">
      <h4 id="modalName">Produto</h4>

      <div class="form-row"><label>Setor</label>
        <select id="sectorSelect"><option value="deposito">Depósito</option><option value="camara">Câmara Fria</option><option value="freezer">Freezer</option><option value="bar">Bar</option></select>
      </div>

      <div class="form-row"><label>Quantidade</label><input id="qtyInput" inputmode="decimal" placeholder="0"></div>

      <div style="margin-top:8px" class="muted">Ao salvar, o valor será somado ao já existente.</div>

      <div class="modal-actions">
        <button class="btn-save" id="modalSave">Salvar</button>
        <button class="btn-cancel" id="modalClose">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- MODAL PDF CHOICE -->
  <div id="modalPdf" class="modal" aria-hidden="true">
    <div class="sheet">
      <h4>Exportar PDF</h4>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <button class="btn-save" id="pdfProducao">Só Produção</button>
        <button class="btn-save" id="pdfBar">Só Bar</button>
        <button class="btn-save" id="pdfAll">Completo</button>
        <button class="btn-cancel" id="modalPdfClose">Cancelar</button>
      </div>
    </div>
  </div>

  <div class="footer-actions" id="footerActions" style="display:none">
    <button class="secondary-btn" id="backHomeFooter">Voltar</button>
    <button class="secondary-btn" id="viewAddedFooter">Ver itens adicionados</button>
  </div>

<script>
/* ---------------------------
   CATALOG (fixed + user added)
--------------------------- */

let CATALOG = [
  {nome :"ALICHE", unidade: "KG", scope:"producao" },
  {nome :"BACON", unidade: "KG", scope:"producao" },
  {nome :"BANHA", unidade: "KG", scope:"producao" },
  {nome :"BROCOLIS", unidade: "KG", scope:"producao" },
  {nome :"CAMARÃO", unidade: "KG", scope:"producao" },
  {nome :"CARNE SECA", unidade: "KG", scope:"producao" },
  {nome :"CHAMPIGNON", unidade: "KG", scope:"producao" },
  {nome :"COGUMELO SHIMEJI", unidade: "KG", scope:"producao" },
  {nome :"COGUMELO SHITAKE", unidade: "KG", scope:"producao" },
  {nome :"COXA/SOBRECOXA FRANGO", unidade: "KG", scope:"producao" },
  {nome :"ERVILHA CONGELADA", unidade: "KG", scope:"producao" },
  {nome :"FILE FRANGO", unidade: "KG", scope:"producao" },
  {nome :"FILET MIGNON", unidade: "KG", scope:"producao" },
  {nome :"LINGUIÇA CALABRESA", unidade: "KG", scope:"producao" },
  {nome :"LINGUIÇA TOSCANA", unidade: "KG", scope:"producao" },
  {nome :"LOMBO", unidade: "KG", scope:"producao" },
  {nome :"MORTADELA", unidade: "KG", scope:"producao" },
  {nome :"PICANHA", unidade: "KG", scope:"producao" },
  {nome :"PEIXINHO", unidade: "KG", scope:"producao" },
  {nome :"PRESUNTO", unidade: "KG", scope:"producao" },
  {nome :"PRESUNTO DE PARMA", unidade: "KG", scope:"producao" },
  {nome :"PEITO DE PERU", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO CREAM CHEESE", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO GORGONZOLA", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO MUÇARELA", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO MUÇARELA DE BUFALA", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO PARMESÃO", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO PROVOLONE", unidade: "KG", scope:"producao" },
  {nome :"QUEIJO RICOTA", unidade: "KG", scope:"producao" },
  {nome :"REQUEIJÃO CATUPIRY", unidade: "KG", scope:"producao" },
  {nome :"REQUEIJÃO CHEDDAR", unidade: "KG", scope:"producao" },
  {nome :"REQUEIJÃO LAZPER", unidade: "KG", scope:"producao" },
  {nome :"SALAME PEPPERONI", unidade: "KG", scope:"producao" },
  {nome :"TOFU", unidade: "KG", scope:"producao" },
  {nome :"TOMATE", unidade: "KG", scope:"producao" },
  {nome :"TOMATE CEREJA", unidade: "KG", scope:"producao" },
  {nome :"TOMATE SECO", unidade: "KG", scope:"producao" },
  {nome :"MOLHO BRANCO", unidade: "KG", scope:"producao" },
  {nome :"MOLHO STROGONOFF", unidade: "KG", scope:"producao" },
  {nome :"COSTELINHA", unidade: "KG", scope:"producao" },
  {nome :"COCADA", unidade: "KG", scope:"producao" },
  {nome :"BURRATINA", unidade: "KG", scope:"producao" },
  { nome:"ABACAXI CONSERVA", unidade:"KG", scope:"producao" },
  { nome:"ABACAXI DOCE", unidade:"KG", scope:"producao" },
  { nome:"ABOBRINHA", unidade:"KG", scope:"producao" },
  { nome:"AÇAFRÃO (CÚRCUMA)", unidade:"KG", scope:"producao" },
  { nome:"AÇÚCAR CONFEITEIRO", unidade:"KG", scope:"producao" },
  { nome:"AÇÚCAR CRISTAL", unidade:"KG", scope:"producao" },
  { nome:"AÇÚCAR REFINADO", unidade:"KG", scope:"producao" },
  { nome:"AÇÚCAR SACHE", unidade:"KG", scope:"producao" },
  { nome:"ADOÇANTE", unidade:"KG", scope:"producao" },
  { nome:"ALECRIM SECO", unidade:"KG", scope:"producao" },
  { nome:"ALHO", unidade:"KG", scope:"producao" },
  { nome:"ALHO DESIDRATADO", unidade:"KG", scope:"producao" },
  { nome:"ATUM", unidade:"KG", scope:"producao" },
  { nome:"AZEITE EXTRA VIRGEM", unidade:"L", scope:"producao" },
  { nome:"AZEITE COMPOSTO", unidade:"L", scope:"producao" },
  { nome:"AZEITONAS PRETAS", unidade:"KG", scope:"producao" },
  { nome:"AZEITONAS VERDES", unidade:"KG", scope:"producao" },
  { nome:"BANANA DA TERRA", unidade:"KG", scope:"producao" },
  { nome:"BANANA PRATA", unidade:"KG", scope:"producao" },
  { nome:"BATATA PALHA", unidade:"KG", scope:"producao" },
  { nome:"BERINJELA", unidade:"KG", scope:"producao" },
  { nome:"BICARBONATO DE SÓDIO", unidade:"KG", scope:"producao" },
  { nome:"CACAU EM PÓ", unidade:"KG", scope:"producao" },
  { nome:"CANELA EM PÓ", unidade:"KG", scope:"producao" },
  { nome:"KETCHUP SALÃO", unidade:"KG", scope:"producao" },
  { nome:"KETCHUP SACHE", unidade:"UN", scope:"producao" },
  { nome:"CEBOLA", unidade:"KG", scope:"producao" },
  { nome:"CEBOLA ROXA", unidade:"KG", scope:"producao" },
  { nome:"CHOCOLATE BRANCO FORNEÁVEL", unidade:"KG", scope:"producao" },
  { nome:"CHOCOLATE AO LEITE FORNEÁVEL", unidade:"KG", scope:"producao" },
  { nome:"CHOCOLATE MEIO AMARGO FORNEÁVEL", unidade:"KG", scope:"producao" },
  { nome:"CHOCOLATE CONFETE", unidade:"KG", scope:"producao" },
  { nome:"CHOCOLATE GRANULADO", unidade:"KG", scope:"producao" },
  { nome:"COBERTURA CHOCOLATE NESTLÉ", unidade:"KG", scope:"producao" },
  { nome:"COBERTURA LEITINHO", unidade:"KG", scope:"producao" },
  { nome:"COBERTURA SORVETE", unidade:"KG", scope:"producao" },
  { nome:"COCO RALADO", unidade:"KG", scope:"producao" },
  { nome:"COLORAU", unidade:"KG", scope:"producao" },
  { nome:"CRAVO MOÍDO", unidade:"KG", scope:"producao" },
  { nome:"CREME DE LEITE", unidade:"UN", scope:"producao" },
  { nome:"DOCE DE LEITE", unidade:"KG", scope:"producao" },
  { nome:"ERVA DOCE", unidade:"KG", scope:"producao" },
  { nome:"ESCAROLA", unidade:"KG", scope:"producao" },
  { nome:"FARINHA SÊMOLA", unidade:"KG", scope:"producao" },
  { nome:"FARINHA TRIGO CANUELAS", unidade:"KG", scope:"producao" },
  { nome:"FARINHA TRIGO VENTURELLI", unidade:"KG", scope:"producao" },
  { nome:"FARINHA TRIGO 00 DI GRANDO VERDE", unidade:"KG", scope:"producao" },
  { nome:"FARINHA TRIGO PASTINI BLUE", unidade:"KG", scope:"producao" },
  { nome:"FARINHA TRIGO PUREZA", unidade:"KG", scope:"producao" },
  { nome:"FARINHA TRIGO NACIONAL", unidade:"KG", scope:"producao" },
  { nome:"FERMENTO FRESCO", unidade:"KG", scope:"producao" },
  { nome:"FERMENTO SECO", unidade:"KG", scope:"producao" },
  { nome:"FIGO EM CALDA", unidade:"KG", scope:"producao" },
  { nome:"GOIABADA", unidade:"KG", scope:"producao" },
  { nome:"LEITE", unidade:"KG", scope:"producao" },
  { nome:"LEITE EM PÓ", unidade:"KG", scope:"producao" },
  { nome:"LEMON PEPPER", unidade:"KG", scope:"producao" },
  { nome:"MAÇÃ", unidade:"KG", scope:"producao" },
  { nome:"MANJERICÃO FRESCO", unidade:"KG", scope:"producao" },
  { nome:"MANJERICÃO SECO", unidade:"KG", scope:"producao" },
  { nome:"MANTEIGA", unidade:"KG", scope:"producao" },
  { nome:"MELAÇO DE CANA", unidade:"KG", scope:"producao" },
  { nome:"MILHO VERDE CONSERVA", unidade:"KG", scope:"producao" },
  { nome:"MOLHO BARBECUE", unidade:"KG", scope:"producao" },
  { nome:"MOLHO PELATI", unidade:"KG", scope:"producao" },
  { nome:"MOLHO PIMENTA", unidade:"KG", scope:"producao" },
  { nome:"MORANGO", unidade:"KG", scope:"producao" },
  { nome:"MOSTARDA (GALÃO)", unidade:"KG", scope:"producao" },
  { nome:"MOSTARDA (SACHE)", unidade:"KG", scope:"producao" },
  { nome:"NOZES", unidade:"KG", scope:"producao" },
  { nome:"NOZ MOSCADA", unidade:"KG", scope:"producao" },
  { nome:"NUTELLA", unidade:"KG", scope:"producao" },
  { nome:"ÓLEO SOJA", unidade:"KG", scope:"producao" },
  { nome:"ORÉGANO", unidade:"KG", scope:"producao" },
  { nome:"OVOS", unidade:"UN", scope:"producao" },
  { nome:"PAÇOCA", unidade:"KG", scope:"producao" },
  { nome:"PALMITO CONSERVA", unidade:"KG", scope:"producao" },
  { nome:"PÁPRICA DOCE", unidade:"KG", scope:"producao" },
  { nome:"PÁPRICA PICANTE", unidade:"KG", scope:"producao" },
  { nome:"PÊSSEGO EM CALDA", unidade:"KG", scope:"producao" },
  { nome:"PIMENTA BIQUINHO", unidade:"KG", scope:"producao" },
  { nome:"PIMENTA CALABRESA", unidade:"KG", scope:"producao" },
  { nome:"PIMENTA DO REINO", unidade:"KG", scope:"producao" },
  { nome:"PISTACHE (CASTANHA)", unidade:"KG", scope:"producao" },
  { nome:"PISTACHE (CREME)", unidade:"KG", scope:"producao" },
  { nome:"POLVILHO DOCE", unidade:"KG", scope:"producao" },
  { nome:"POLVILHO AZEDO", unidade:"KG", scope:"producao" },
  { nome:"RÚCULA", unidade:"KG", scope:"producao" },
  { nome:"SAL CURA", unidade:"KG", scope:"producao" },
  { nome:"SAL GROSSO", unidade:"KG", scope:"producao" },
  { nome:"SAL REFINADO", unidade:"KG", scope:"producao" },
  { nome:"SALSINHA", unidade:"KG", scope:"producao" },
  { nome:"TOMATE", unidade:"KG", scope:"producao" },
  { nome:"XERÉM", unidade:"KG", scope:"producao" },

  {nome:"AGUA C/ GAS", unidade:"UN", scope:"bar"},
  {nome:"AGUA C/ GAS (REFFIL) 1,5 LT", unidade:"UN", scope:"bar"},
  {nome:"AGUA S/ GAS", unidade:"UN", scope:"bar"},
  {nome:"AGUA TONICA LATA", unidade:"UN", scope:"bar"},
  {nome:"AGUA TONICA DIET LATA", unidade:"UN", scope:"bar"},
  {nome:"AGUA TONICA 1 LT", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA AMSTEL 600 ML", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA BRAHMA 600 ML", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA BRAHMA DUPLO MALTE 600 ML", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA EISENBAHN 600 ML", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA HEINEKEN 600 ML", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA HEINEKEN LONG NECK", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA HEINEKEN LONG NECK ZERO", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA MALZBEER LATA /LONG NECK", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA ORIGINAL 600 ML", unidade:"UN", scope:"bar"},
  {nome:"CERVEJA SKOL 600 ML", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA 2 LT", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA 2 LT ZERO", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA 600 ML PET", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA 1 LT RET", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA 600 ML ZERO PET", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA KS 290 ML", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA KS 290 ML ZERO", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA LATA", unidade:"UN", scope:"bar"},
  {nome:"COCA COLA LATA ZERO", unidade:"UN", scope:"bar"},
  {nome:"FANTA LARANJA 2 LT", unidade:"UN", scope:"bar"},
  {nome:"FANTA LARANJA LATA", unidade:"UN", scope:"bar"},
  {nome:"FANTA UVA 2 LT", unidade:"UN", scope:"bar"},
  {nome:"GUARANA ANT 2 LT", unidade:"UN", scope:"bar"},
  {nome:"GUARANA ANT 2 LT DIET", unidade:"UN", scope:"bar"},
  {nome:"GUARANA ANT 600 ML", unidade:"UN", scope:"bar"},
  {nome:"GUARANA ANT LATA", unidade:"UN", scope:"bar"},
  {nome:"GUARANA ANT LATA DIET", unidade:"UN", scope:"bar"},
  {nome:"H2OH LIMÃO", unidade:"UN", scope:"bar"},
  {nome:"H2OH LIMONETO", unidade:"UN", scope:"bar"},
  {nome:"SCHUPPERS LATA", unidade:"UN", scope:"bar"},
  {nome:"SPRIT 2 LT", unidade:"UN", scope:"bar"},
  {nome:"SPRIT LATA", unidade:"UN", scope:"bar"},
  {nome:"V. ALTO LOS ROMEROS CARMENERE", unidade:"UN", scope:"bar"},
  {nome:"V. CHAC CHAC MALBEC ", unidade:"UN", scope:"bar"},
  {nome:"V. 120 MERLOT (375 ML) ", unidade:"UN", scope:"bar"},
  {nome:"V. 120 CABERNET (375 ML) ", unidade:"UN", scope:"bar"},
  {nome:"V. ALTO LOS ROMEROS PINOT NOIR ", unidade:"UN", scope:"bar"},
  {nome:"V. ALTO LOS ROMEROS CARMENERE ", unidade:"UN", scope:"bar"},
  {nome:"V. PORTADA LOTE DFG", unidade:"UN", scope:"bar"},
  {nome:"V. CARMEN PREMIER CABER SAUV 750 ML", unidade:"UN", scope:"bar"},
  {nome:"V. CARMEN PREMIER CARMENERE 750 ML", unidade:"UN", scope:"bar"},
  {nome:"V. CARTA VIEJA CABERNET SAUV. 375 ML", unidade:"UN", scope:"bar"},
  {nome:"V. CARTA VIEJA CABERNET SAUV. 750 ML", unidade:"UN", scope:"bar"},
  {nome:"V. CARTA VIEJA MERLOT 750 ML", unidade:"UN", scope:"bar"},
  {nome:"V. CHAC CHAC CABERNET FRANC", unidade:"UN", scope:"bar"},
  {nome:"V. CONCHA Y TORO CABERNET SAUVIGN", unidade:"UN", scope:"bar"},
  {nome:"V. CONCHA Y TORO CARMENERE", unidade:"UN", scope:"bar"},
  {nome:"V. CONCHA Y TORO MALBEC", unidade:"UN", scope:"bar"},
  {nome:"V. CORDEIRO CABERNET SAUVIGNON", unidade:"UN", scope:"bar"},
  {nome:"V. CORDEIRO MALBEC", unidade:"UN", scope:"bar"},
  {nome:"V. DON SIMON", unidade:"UN", scope:"bar"},
  {nome:"V. D.V. CATENA MALBEC MALBEC", unidade:"UN", scope:"bar"},
  {nome:"V. D.V. CATENA PINOT NOIR", unidade:"UN", scope:"bar"},
  {nome:"V. KOYLE CABERNET SAUVIGNON", unidade:"UN", scope:"bar"},
  {nome:"V. LA LINDA CABERNET SAUVIGNON", unidade:"UN", scope:"bar"},
  {nome:"V. LA LINDA MALBEC", unidade:"UN", scope:"bar"},
  {nome:"V. LAFIOLE", unidade:"UN", scope:"bar"},
  {nome:"V. LEYDA CABERNET SAUVIGNON", unidade:"UN", scope:"bar"},
  {nome:"V. LEYDA PINOT NOIR", unidade:"UN", scope:"bar"},
  {nome:"V. PORTADA", unidade:"UN", scope:"bar"},
  {nome:"V. SANTA EMA 375 ML", unidade:"UN", scope:"bar"},
  {nome:"V. STA FELICIDADE SECO", unidade:"UN", scope:"bar"},
  {nome:"V. STA FELICIDADE SUAVE", unidade:"UN", scope:"bar"},
  {nome:"V. UNDURRAGA CABERNET SAUVIGNON", unidade:"UN", scope:"bar"},
  {nome:"V. UNDURRAGA CARMENERE", unidade:"UN", scope:"bar"},
  {nome:"V. UNDURRAGA CABERNET MERLOT", unidade:"UN", scope:"bar"},
  {nome:"V. 120 CABERNET SAUVIGNON 187,5 ML", unidade:"UN", scope:"bar"},
  {nome:"V. 120 CABERNET CARMENERE", unidade:"UN", scope:"bar"},
  {nome:"V. 3 MEDALHAS CABERNET", unidade:"UN", scope:"bar"},
  {nome:"ICE TEA (PO)", unidade:"KG", scope:"bar"},
  {nome:"XAROPE ABACAXI C/ HORTELA", unidade:"L", scope:"bar"},
  {nome:"XAROPE CRANBERRY", unidade:"L", scope:"bar"},
  {nome:"XAROPE LIMÃO SICILIANO", unidade:"L", scope:"bar"},
  {nome:"XAROPE MAÇÃ VERDE", unidade:"L", scope:"bar"},
  {nome:"XAROPE PINK LEMONADE", unidade:"L", scope:"bar"},
  {nome:"XAROPE TANGERINA", unidade:"L", scope:"bar"},
  {nome:"ABACAXI CONGELADO", unidade:"KG", scope:"bar"},
  {nome:"ABACAXI FRUTA INTEIRA", unidade:"KG", scope:"bar"},
  {nome:"APEROL", unidade:"L", scope:"bar"},
  {nome:"ALECRIM FRESCO", unidade:"KG", scope:"bar"},
  {nome:"ANIZ ESTRELADO", unidade:"KG", scope:"bar"},
  {nome:"BITTER CAMPARI", unidade:"L", scope:"bar"},
  {nome:"CACHAÇA", unidade:"L", scope:"bar"},
  {nome:"CANELA EM PAU", unidade:"KG", scope:"bar"},
  {nome:"ENERGETICO TROPICAL", unidade:"UN", scope:"bar"},
  {nome:"ENERGETICO RED BULL", unidade:"UN", scope:"bar"},
  {nome:"ESPUMANTE SALTON", unidade:"L", scope:"bar"},
  {nome:"FRUTAS VERMELHAS CONGELADAS", unidade:"KG", scope:"bar"},
  {nome:"GENGIBRE", unidade:"KG", scope:"bar"},
  {nome:"GIN GORDONS", unidade:"L", scope:"bar"},
  {nome:"GIN TANQUERAY", unidade:"L", scope:"bar"},
  {nome:"GROSELHA", unidade:"KG", scope:"bar"},
  {nome:"LARANJA", unidade:"KG", scope:"bar"},
  {nome:"LEITE COCO", unidade:"L", scope:"bar"},
  {nome:"LIMAO THAITI", unidade:"KG", scope:"bar"},
  {nome:"LIMAO SICILIANO", unidade:"KG", scope:"bar"},
  {nome:"LIMAO DESIDRATADO", unidade:"UN", scope:"bar"},
  {nome:"MARACUJA", unidade:"KG", scope:"bar"},
  {nome:"MORANGO CONGELADO", unidade:"KG", scope:"bar"},
  {nome:"PIMENTA DENTE DE MOCA", unidade:"UN", scope:"bar"},
  {nome:"PIMENTA ROSA", unidade:"UN", scope:"bar"},
  {nome:"RAPADURA", unidade:"KG", scope:"bar"},
  {nome:"RUM", unidade:"L", scope:"bar"},
  {nome:"VERMOUTH MARTINI", unidade:"L", scope:"bar"},
  {nome:"VODKA", unidade:"L", scope:"bar"},
  {nome:"ZIMBRO", unidade:"UN", scope:"bar"},
  {nome:"WISKY", unidade:"L", scope:"bar"},
];

/* ---------------------------
   USER CATALOG persistence
--------------------------- */
const CATALOG_KEY = 'CATALOG_user_v1';
let USER_CATALOG = [];

function loadUserCatalog(){
  try{
    USER_CATALOG = JSON.parse(localStorage.getItem(CATALOG_KEY) || '[]');
  } catch(e){ USER_CATALOG = []; }
}

function persistUserCatalog(){
  localStorage.setItem(CATALOG_KEY, JSON.stringify(USER_CATALOG));
}

function mergeUserCatalogIntoCatalog(){
  const base = new Set(CATALOG.map(p => p.nome.toLowerCase()));
  for(const p of USER_CATALOG){
    if(!base.has(p.nome.toLowerCase())){
      CATALOG.push(p);
      base.add(p.nome.toLowerCase());
    }
  }
}

loadUserCatalog();
mergeUserCatalogIntoCatalog();

/* ---------------------------
   BALANCE
--------------------------- */
const STORAGE_KEY = 'BALANCE_v1';
let BALANCE = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

function persistBalance(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(BALANCE));
}

/* ---------------------------
   UI references
--------------------------- */
const prodGrid = document.getElementById('prodGrid');
const prodCard = document.getElementById('prodCard');
const addedCard = document.getElementById('addedCard');
const cadCard = document.getElementById('cadCard');
const addedListEl = document.getElementById('addedList');
const prodTitle = document.getElementById('prodTitle');
const searchInput = document.getElementById('searchInput');

/* ---------------------------
   NAVIGATION
--------------------------- */
document.getElementById('btnProducao').onclick = ()=>openCatalog('producao');
document.getElementById('btnBar').onclick = ()=>openCatalog('bar');
document.getElementById('btnCadastrar').onclick = ()=>openRegister();

document.getElementById('backHome').onclick = backHome;
document.getElementById('backFromAdded').onclick = backHome;

document.getElementById('viewAddedBtn').onclick = openAdded;
document.getElementById('clearBalance').onclick = ()=>{
  if(confirm('Limpar todos os registros?')){
    BALANCE = [];
    persistBalance();
    renderAdded();
  }
};

document.getElementById('cancelNew').onclick = backHome;

/* ---------------------------
   CATALOG VIEW
--------------------------- */
function openCatalog(scope){
  document.getElementById('menu').style.display='none';
  addedCard.style.display='none';
  cadCard.style.display='none';
  prodCard.style.display='block';

  prodTitle.textContent = scope === 'producao' ? 'Produção' : 'Bar';

  prodGrid.innerHTML = "";

  const items = CATALOG
    .filter(p => p.scope === scope)
    .sort((a,b)=> a.nome.localeCompare(b.nome,'pt-BR'));

  items.forEach(p=>{
    const btn = document.createElement("button");
    btn.className="prod-btn";
    btn.innerHTML = `<span class="prod-name">${p.nome}</span><small>${p.unidade}</small>`;
    btn.onclick = ()=>openModalFor(p);
    prodGrid.appendChild(btn);
  });

  applySearchFilter();
}

/* ---------------------------
   REGISTER PRODUCT
--------------------------- */
function openRegister(){
  document.getElementById('menu').style.display='none';
  prodCard.style.display='none';
  addedCard.style.display='none';
  cadCard.style.display='block';
}

/* ---------------------------
   HOME
--------------------------- */
function backHome(){
  prodCard.style.display='none';
  addedCard.style.display='none';
  cadCard.style.display='none';
  document.getElementById('menu').style.display='block';
}

/* ---------------------------
   MODAL ADD/EDIT
--------------------------- */
const modal = document.getElementById('modal');
const modalName = document.getElementById('modalName');
const sectorSelect = document.getElementById('sectorSelect');
const qtyInput = document.getElementById('qtyInput');
const modalSave = document.getElementById('modalSave');
const modalClose = document.getElementById('modalClose');

let currentProduct = null;

function openModalFor(product){
  currentProduct = product;
  modalName.textContent = product.nome;

  // setor inicial
  sectorSelect.value = product.scope === 'bar' ? 'bar' : 'deposito';

  qtyInput.value = "";
  modal.style.display='flex';
  setTimeout(()=>qtyInput.focus(),200);
}

modalClose.onclick = ()=> modal.style.display='none';

modalSave.onclick = ()=>{
  const sector = sectorSelect.value;
  const q = parseFloat(qtyInput.value.replace(",",".") || 0);
  if(q <= 0){ alert("Quantidade inválida"); return; }

  let entry = BALANCE.find(x=>x.produto === currentProduct.nome);
  if(!entry){
    entry = { produto:currentProduct.nome, unidade:currentProduct.unidade, deposito:0, camara:0, freezer:0, bar:0 };
    BALANCE.push(entry);
  }

  entry[sector] = Number(((entry[sector]||0)+q).toFixed(3));
  persistBalance();

  modal.style.display='none';
  openCatalog(currentProduct.scope);
};

/* ---------------------------
   ADDED LIST
--------------------------- */
function openAdded(){
  document.getElementById('menu').style.display='none';
  prodCard.style.display='none';
  cadCard.style.display='none';
  addedCard.style.display='block';
  renderAdded();
}

function renderAdded(){
  addedListEl.innerHTML="";

  if(BALANCE.length===0){
    addedListEl.innerHTML = '<div class="muted">Nenhum item adicionado.</div>';
    return;
  }

  const sorted = BALANCE.slice().sort((a,b)=>a.produto.localeCompare(b.produto,'pt-BR'));

  for(const item of sorted){
    const div = document.createElement("div");
    div.className="entry";

    const left = document.createElement("div");
    left.innerHTML = `
      <strong>${item.produto}</strong>
      <small>${item.unidade} • Dep: ${item.deposito} • Cam: ${item.camara} • Freez:${item.freezer} • Bar:${item.bar}</small>
    `;

    const controls = document.createElement("div");
    controls.style.display="flex";
    controls.style.gap="8px";

    const edit = document.createElement("button");
    edit.className="secondary-btn";
    edit.textContent="Editar";
    edit.style.padding="6px 10px";

    edit.onclick = ()=>{
      // setor correto do catálogo
      const scopeCorrect = (CATALOG.find(p=>p.nome===item.produto)?.scope || 'producao');
      currentProduct = { nome:item.produto, unidade:item.unidade, scope:scopeCorrect };
      modalName.textContent = item.produto;
      sectorSelect.value = scopeCorrect === "bar" ? "bar" : "deposito";
      qtyInput.value="";
      modal.style.display="flex";
    };

    const del = document.createElement("button");
    del.className="secondary-btn";
    del.style.background="#c0392b";
    del.textContent="Remover";

    del.onclick = ()=>{
      if(confirm("Remover este item?")){
        BALANCE = BALANCE.filter(b=>b.produto !== item.produto);
        persistBalance();
        renderAdded();
      }
    };

    controls.appendChild(edit);
    controls.appendChild(del);
    div.appendChild(left);
    div.appendChild(controls);
    addedListEl.appendChild(div);
  }
}

/* ---------------------------
   Search filter
--------------------------- */
searchInput.oninput = applySearchFilter;

function applySearchFilter(){
  const t = searchInput.value.toLowerCase();
  document.querySelectorAll(".prod-btn").forEach(btn=>{
    const name = btn.querySelector(".prod-name").textContent.toLowerCase();
    btn.style.display = name.includes(t) ? "flex" : "none";
  });
}

/* ---------------------------
   PDF (opção com tabela por setor)
--------------------------- */
function generatePdf(filterScope){
  document.getElementById('modalPdf').style.display='none';

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF("p","pt","a4");
  const margin = 40;
  let y = 40;

  const pet = [15,95,92];
  const gra = [34,34,34];
  const now = new Date();

  let title = "Relatório de Estoque";
  if(filterScope==="producao") title="Relatório — Produção";
  if(filterScope==="bar") title="Relatório — Bar";
  if(filterScope==="all") title="Relatório — Estoque Geral";

  doc.setFontSize(16);
  doc.setTextColor(...pet);
  doc.text(title,margin,y);
  y+=18;

  doc.setFontSize(10);
  doc.setTextColor(...gra);
  doc.text("Gerado em: "+now.toLocaleString(),margin,y);
  y+=16;

  const balanceMap = {};
  for(const b of BALANCE) balanceMap[b.produto] = b;

  /* PRODUÇÃO */
  if(filterScope==="producao" || filterScope==="all"){
    const list = CATALOG.filter(p=>p.scope==="producao")
      .map(p=>p.nome)
      .sort((a,b)=>a.localeCompare(b,'pt-BR'));

    const rows=[];
    for(const name of list){
      const b = balanceMap[name];
      if(!b) continue;
      const dep=b.deposito||0, cam=b.camara||0, fr=b.freezer||0;
      const tot = dep+cam+fr;
      if(tot>0) rows.push([name,dep,cam,fr,tot]);
    }

    if(rows.length>0){
      doc.setFontSize(12);
      doc.setTextColor(...pet);
      doc.text("PRODUÇÃO",margin,y); y+=8;

      doc.autoTable({
        startY:y,
        head:[["Produto","Dep.","Câm.","Freezer","Total"]],
        body:rows,
        theme:"grid",
        headStyles:{fillColor:pet,textColor:255},
        styles:{fontSize:9,cellPadding:5},
        margin:{left:margin,right:margin}
      });
      y = doc.lastAutoTable.finalY + 18;
    }
  }

  if(y>700){ doc.addPage(); y=40; }

  /* BAR */
  if(filterScope==="bar" || filterScope==="all"){
    const list = CATALOG.filter(p=>p.scope==="bar")
      .map(p=>p.nome)
      .sort((a,b)=>a.localeCompare(b,'pt-BR'));

    const rows=[];
    for(const name of list){
      const b=balanceMap[name];
      if(!b) continue;
      const dep=b.deposito||0, bar=b.bar||0;
      const tot = dep + bar;
      if(tot>0) rows.push([name,dep,bar,tot]);
    }

    if(rows.length>0){
      doc.setFontSize(12);
      doc.setTextColor(...pet);
      doc.text("BAR",margin,y); y+=8;

      doc.autoTable({
        startY:y,
        head:[["Produto","Dep.","Bar","Total"]],
        body:rows,
        theme:"grid",
        headStyles:{fillColor:pet,textColor:255},
        styles:{fontSize:9,cellPadding:5},
        margin:{left:margin,right:margin}
      });

      y = doc.lastAutoTable.finalY + 18;
    }
  }

  const ts = now.toISOString().replace(/[:T]/g,"-").slice(0,19);
  doc.save("balanco_"+filterScope+"_"+ts+".pdf");
}

/* ---------------------------
   PDF modal buttons
--------------------------- */
document.getElementById("pdfProducao").onclick = ()=>generatePdf("producao");
document.getElementById("pdfBar").onclick = ()=>generatePdf("bar");
document.getElementById("pdfAll").onclick = ()=>generatePdf("all");
document.getElementById("modalPdfClose").onclick = ()=>document.getElementById("modalPdf").style.display="none";
document.getElementById("openPdfModal").onclick = ()=>document.getElementById("modalPdf").style.display="flex";

/* ---------------------------
   INIT
--------------------------- */
(function(){
  document.getElementById("modal").onclick = e=>{ if(e.target.id==="modal") modal.style.display="none"; };
  document.getElementById("modalPdf").onclick = e=>{ if(e.target.id==="modalPdf") document.getElementById("modalPdf").style.display="none"; };
  backHome();
})();
</script>

</body>
</html>
